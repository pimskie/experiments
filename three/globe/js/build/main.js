var Globe=function(){"use strict";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var a=function(a){a=a||{},this.defaults={radius:100,markers:[{lat:51.923426,lon:4.469059},{lat:46.648258,lon:105.122681}]},this.options=_.extend(this.defaults,a),this.lightPos={radiusY:150,radiusX:100,radiusZ:150,radian:0,x:100,y:120,z:120},this.winW=window.innerWidth,this.winH=window.innerHeight,this.scene=null,this.camera=null,this.renderer=null,this.markers=[],this._setupStage(),this._setupLight(),this._setupControls(),this.meshGlobe=this._createGlobe({radius:this.options.radius,transparent:!1,texture:"img/2_no_clouds_8k.jpg"}),this.meshClouds=this._createGlobe({radius:this.options.radius+3,transparent:!0,texture:"img/n_amer_clouds_8k.png"}),this.planet=new THREE.Object3D,this.planet.add(this.meshGlobe),this.planet.add(this.meshClouds);var b,c,d=50;return _.each(this.options.markers,_.bind(function(a){b=this._convertLatLonToVec3(a.lat,a.lon,this.options.radius,d),a.vec3=b,c=this._createMarker(b,d),this.markers.push(c),this.planet.add(c)},this)),this.scene.add(this.planet),this._testLine(),this._render(),this};return a.prototype._setupStage=function(){return this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,this.winW/this.winH,.01,1e3),this.camera.position.z=500,this.renderer=new THREE.WebGLRenderer({alpha:!0}),this.renderer.setSize(this.winW,this.winH),this.renderer.domElement.classList.add("stage"),document.body.appendChild(this.renderer.domElement),this},a.prototype._setupLight=function(){this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(this.lightPos.x,this.lightPos.y,this.lightPos.z),this.scene.add(this.light)},a.prototype._setupControls=function(){this.controls=new THREE.OrbitControls(this.camera),this.controls.damping=.001},a.prototype._createGlobe=function(a){var b=new THREE.Mesh(new THREE.SphereGeometry(a.radius,100,100),new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture(a.texture),shading:THREE.SmoothShading,transparent:a.transparent}));return b.overdraw=!0,b},a.prototype._createMarker=function(a,b){var c=new THREE.Mesh(new THREE.BoxGeometry(1,1,b),new THREE.MeshBasicMaterial({color:16711680}));return c.position.x=a.x,c.position.y=a.y,c.position.z=a.z,c.lookAt(new THREE.Vector3(0,0,0)),c},a.prototype._testLine=function(){{var a=this.options.markers[0],b=this.options.markers[1],c=Math.min(a.lat,b.lat)+(Math.max(a.lat,b.lat)-Math.min(a.lat,b.lat))/2,d=Math.min(a.lon,b.lon)+(Math.max(a.lon,b.lon)-Math.min(a.lon,b.lon))/2,e=this._convertLatLonToVec3(c,d,200,40),f=100,g=new THREE.Geometry,h=new THREE.QuadraticBezierCurve3,i=new THREE.LineBasicMaterial({color:16777215,linewidth:2});this.markers[0].position.x,this.markers[1].position.y,this.markers[1].position.z}h.v0=this.markers[0].position,h.v1=e,h.v2=this.markers[1].position;for(var j=0;f>j;j++)g.vertices.push(h.getPoint(j/f));var k=new THREE.Line(g,i);this.planet.add(k)},a.prototype._render=function(){function a(){window.requestAnimationFrame(a),b.meshClouds.rotation.x+=1e-4,b.meshClouds.rotation.y+=.002,b.renderer.render(b.scene,b.camera)}var b=this;a()},a.prototype._latLongToVector3=function(a,b,c,d){var e=a*Math.PI/180,f=(b-180)*Math.PI/180,g=-(c+d)*Math.cos(e)*Math.cos(f),h=(c+d)*Math.sin(e),i=(c+d)*Math.cos(e)*Math.sin(f);return new THREE.Vector3(g,h,i)},a.prototype._convertLatLonToVec3=function(a,b,c,d){var e=Math.PI/180;a*=e,b=-b*e;var f=new THREE.Vector3(Math.cos(a)*Math.cos(b),Math.sin(a),Math.cos(a)*Math.sin(b));return f=f.multiplyScalar(.5*d+c)},a}(Globe||{});!function(a){"use strict";function b(){new a}b()}(Globe);